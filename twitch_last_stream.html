<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>頂級BirdBro</title>
  <link rel="stylesheet" href="style.css">
  <script src="config.js"></script>
</head>
<body>
  <div class="main-content">
    <h1>頂級BirdBro</h1>
    <div id="result">載入中...</div>
    <div class="profile" id="profile">
      <a id="avatar-link" href="https://www.twitch.tv/nakasufps" target="_blank">
        <img id="avatar" class="avatar" src="" alt="頭像" style="display:none;">
      </a>
      <div class="display-name" id="displayName"></div>
      <div class="login-name" id="loginName"></div>
    </div>
  </div>
  <script>
  // 請在 config.js 設定 TWITCH_CLIENT_ID 與 TWITCH_ACCESS_TOKEN
  let clientId = typeof TWITCH_CLIENT_ID !== 'undefined' ? TWITCH_CLIENT_ID : '';
  let accessToken = typeof TWITCH_ACCESS_TOKEN !== 'undefined' ? TWITCH_ACCESS_TOKEN : '';




      let lastTime = null;
      let lastStreamTitle = '';
      async function showNakasufpsLastStream() {
        const resultDiv = document.getElementById('result');
        const avatarImg = document.getElementById('avatar');
        const displayNameDiv = document.getElementById('displayName');
        const loginNameDiv = document.getElementById('loginName');
        // 取得 user 資訊
        const userRes = await fetch(`https://api.twitch.tv/helix/users?login=nakasufps`, {
          headers: {
            'Client-ID': clientId,
            'Authorization': `Bearer ${accessToken}`
          }
        });
        const userData = await userRes.json();
        if (!userData.data || userData.data.length === 0) {
          resultDiv.innerText = '找不到 nakasufps 頻道';
          return;
        }
        const user = userData.data[0];
        // 設定頭像與名稱
        avatarImg.src = user.profile_image_url;
        avatarImg.style.display = 'block';
        displayNameDiv.textContent = user.display_name;
        loginNameDiv.textContent = '@' + user.login;

        const userId = user.id;

        // 取得最近的直播紀錄
        const streamRes = await fetch(`https://api.twitch.tv/helix/videos?user_id=${userId}&type=archive&first=1`, {
          headers: {
            'Client-ID': clientId,
            'Authorization': `Bearer ${accessToken}`
          }
        });
        const streamData = await streamRes.json();
        if (!streamData.data || streamData.data.length === 0) {
          resultDiv.innerText = '查無直播紀錄';
          return;
        }
        const lastStream = streamData.data[0];
        lastTime = new Date(lastStream.created_at);
        lastStreamTitle = lastStream.title;
        updateTimeDisplay();
        setInterval(updateTimeDisplay, 1000);
      }

      function updateTimeDisplay() {
        if (!lastTime) return;
        const resultDiv = document.getElementById('result');
        const now = new Date();
        const diffMs = now - lastTime;
        const diffSec = Math.floor(diffMs / 1000);
        const days = Math.floor(diffSec / (60 * 60 * 24));
        const hours = Math.floor((diffSec % (60 * 60 * 24)) / (60 * 60));
        const minutes = Math.floor((diffSec % (60 * 60)) / 60);
        const seconds = diffSec % 60;
        resultDiv.innerHTML =
          `<b>上次開台標題：</b>${lastStreamTitle}<br>` +
          `<b>上次開台時間：</b>${lastTime.toLocaleString()}<br>` +
          `<b>已經 </b><span class="offline-time">${days} 天 ${hours} 小時 ${minutes} 分 ${seconds} 秒</span> 沒開台了:`;
      }

      // 頁面載入自動查詢
      showNakasufpsLastStream();

  </script>
</body>
</html>
